generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String                @id @default(cuid())
  email                String?               @unique
  name                 String
  role                 Role                  @default(ADMIN)
  password             String?
  subscription         SubscriptionType      @default(FREE)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  leads                Lead[]
  whatsappIntegrations WhatsAppIntegration[]
  campaigns            WhatsappCampaign[]
  whatsappTokens       WhatsappToken[]
  reminders            Reminder[]
  payments             Payment[]
}

model Lead {
  id        String     @id @default(cuid())
  name      String
  email     String?    @unique
  phone     String?    @db.VarChar(20)
  company   String?
  leadsCreatedDate DateTime?
  leadsUpdatedDates DateTime?
  enquiryDate DateTime?
  bookingDate DateTime?
  checkInDates DateTime?
  amount    Decimal?  @db.Decimal(12, 2)
  source    String?
  notes     String?
  tag       Tag        @default(DISQUALIFIED)
  status    LeadStatus @default(PENDING)
  duration  Int
  userId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  reminders Reminder[]
}

model WhatsAppIntegration {
  id        String   @id @default(cuid())
  apiKey    String
  apiSecret String?
  provider  Provider
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WhatsappCampaign {
  id             String         @id @default(cuid())
  campaignName   String
  description    String?
  campaignType   CampaignType
  priority       Priority
  messageType    MessageType
  messageContent String
  mediaURL       String?
  templateID     String?
  userId         String
  status         CampaignStatus @default(PAUSED) // âœ… add this
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WhatsappToken {
  id        String   @id @default(cuid())
  token     String
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId])
}

model Reminder {
  id           String       @id @default(cuid())
  title        String
  description  String?
  reminderDate DateTime
  reminderType ReminderType @default(GENERAL)
  priority     Priority     @default(MEDIUM)
  isCompleted  Boolean      @default(false)
  userId       String
  leadId       String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  lead         Lead?        @relation(fields: [leadId], references: [id], onDelete: SetNull)
}

enum Role {
  EMPLOYEE
  ADMIN
  OTHER
}

enum SubscriptionType {
  FREE
  PREMIUM
}

enum CampaignType {
  PROMOTIONAL
  TRANSACTIONAL
  MARKETING
  NOTIFICATION
  REMINDER
}

enum Priority {
  HIGH
  MEDIUM
  LOW
  URGENT
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  TEMPLATE
}

enum Source {
  SOCIAL
  REFERRAL
  EVENT
  MARKETING
  OTHER
}

enum Tag {
  HOT
  WARM
  COLD
  QUALIFIED
  DISQUALIFIED
}

enum LeadStatus {
  PENDING
  FOLLOW_UP
  CONVERTED
  REJECTED
}

enum Status {
  REQUESTED
  RUNNING
  COMPLETE
  CREATED
  REJECTED
}

enum Provider {
  TWILIO
  DIALOG360
  OTHER
  WHATSAPPBUSINESSAPI
}

enum CampaignStatus {
  ACTIVE
  PAUSED
}

enum ReminderType {
  CALL
  EMAIL
  MEETING
  FOLLOW_UP
  GENERAL
  TASK
}

model Payment {
  id                 String        @id @default(cuid())
  orderId            String        @unique
  userId             String
  amount             Decimal       @db.Decimal(12, 2)
  currency           String        @default("INR")
  status             PaymentStatus @default(PENDING)
  razorpayOrderId    String?       @unique
  razorpayPaymentId  String?       @unique
  razorpaySignature  String?
  receipt            String?
  notes              String?
  paymentMethod      String?
  paidAt             DateTime?
  failureReason      String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}
